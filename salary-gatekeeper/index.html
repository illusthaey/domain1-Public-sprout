<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>출입문개폐전담원 월별 인건비 지출서식</title>

  <link rel="icon" href="/static/favicon.ico" />
  <link rel="stylesheet" href="/static/style.css" />

  <!-- 외부 라이브러리(클라이언트 전용) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    /* 페이지 전용(최소 추가) */
    .mini { font-size: 0.95rem; color: #555; }
    .pill { display:inline-block; padding: 4px 10px; border:1px solid #e5e7eb; border-radius:999px; background:#fafafa; font-size:0.92rem; }
    .warn { color:#b45309; }
    .ok { color:#047857; }
    .kpi { font-weight: 800; color:#111; }
    .hint { font-size: 0.95rem; color: #666; margin-top: 6px; }
    .tight { margin-top: 8px; }
    .w-100 { width: 100%; }
    .cell-focus { outline: 2px solid rgba(0, 81, 168, 0.35) !important; border-color:#b4b4d0 !important; background:#fff !important; }

    .calendar {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      background: #fff;
    }
    .calendar th, .calendar td {
      border: 1px solid #e5e7eb;
      vertical-align: top;
      padding: 8px 8px;
      height: 86px;
    }
    .calendar th { background: #f9fafb; font-weight: 700; text-align: center; }
    .cal-day { display:flex; justify-content: space-between; align-items:center; margin-bottom: 6px; }
    .cal-num { font-weight: 800; color:#111; }
    .cal-sub { font-size: 0.88rem; color:#666; }
    .cal-controls { display:flex; gap:8px; align-items:center; }
    .cal-controls input[type="number"] { width: 84px; padding: 6px 8px; border-radius: 10px; }
    .cal-controls label { font-size: 0.92rem; color:#333; display:flex; gap:6px; align-items:center; }

    .preview-box { border:1px solid #e5e7eb; border-radius:12px; padding: 14px; background:#fff; }
    .payslip {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      table-layout: fixed;
    }
    .payslip th, .payslip td {
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      vertical-align: middle;
      font-size: 0.98rem;
    }
    .payslip .h { background:#f9fafb; font-weight: 800; }
    .payslip .right { text-align: right; }
    .payslip .center { text-align: center; }
    .payslip .title { font-size: 1.1rem; font-weight: 900; text-align:center; }
    .payslip .subhead { background:#fafafa; font-weight:800; }
    .payslip .muter { color:#666; font-size:0.92rem; }
    .payslip .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:0.92rem; }
    .no-print { display: block; }
    @media print {
      .no-print { display: none !important; }
      body { background:#fff; }
      .section { border:0; }
    }
  </style>
</head>

<body>
  <main class="container">

    <div class="home-link-wrap">
      <a class="btn-home" href="/">← 메인으로</a>
    </div>

    <h1>출입문개폐전담원 월별 인건비 지출서식</h1>
    <p class="subtitle">클라이언트(브라우저)에서만 동작 · 엑셀/PDF 저장 지원</p>

    <p class="muted">
      ·2025 지침 시급: 89,600/8=11,200원 · 2026 지침 시급: 92,000/8=11,500원<br/>
      ·단가 기본값은 11,500원이며, 수기 수정 가능<br/>
      ·사회보험료 개인부담금은 기본 “미공제”이며, “공제”로 바꾸면 요율 자동 산출(수기 덮어쓰기 가능)
    </p>

    <section class="section">
      <h2 class="local-h2">1) 기본 정보</h2>
      <hr/>

      <div class="grid two">
        <div class="card">
          <div class="row between">
            <div><strong>지급월</strong> <span class="muted">(출근내역 달력 기준)</span></div>
            <span class="pill" id="contractWeeklyHoursPill">주간 계약시간: -</span>
          </div>
          <div class="row gap tight">
            <input id="payMonth" type="month" class="w-100" />
            <button class="btn ghost" id="fillByScheduleBtn" type="button">달력 자동채우기</button>
            <button class="btn ghost" id="clearCalendarBtn" type="button">달력 초기화</button>
          </div>
          <div class="hint">자동채우기: 요일별 근로시간이 0이 아닌 날(기본: 월~금)을 모두 출근(O) 처리합니다.</div>
        </div>

        <div class="card">
          <div class="row between">
            <div><strong>지급일자</strong></div>
            <span class="pill">저장: <span id="saveStateText">-</span></span>
          </div>
          <div class="row gap tight">
            <input id="payDate" type="date" class="w-100" />
            <button class="btn ghost" id="saveNowBtn" type="button">입력값 저장</button>
            <button class="btn ghost" id="resetAllBtn" type="button">전체 초기화</button>
          </div>
          <div class="hint">입력값은 브라우저에 자동 저장됩니다(같은 PC/브라우저).</div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="local-h2">2) 학교 · 근로자 정보</h2>
      <hr/>

      <div class="grid three">
        <div class="field">
          <div class="muted">학교명</div>
          <input id="schoolName" type="text" placeholder="예) ○○초" />
        </div>
        <div class="field">
          <div class="muted">근로자 성명</div>
          <input id="workerName" type="text" placeholder="예) 홍길동" />
        </div>
        <div class="field">
          <div class="muted">직종</div>
          <input id="jobTitle" type="text" value="출입문개폐전담원" />
        </div>

        <div class="field">
          <div class="muted">생년월일</div>
          <input id="birthDate" type="date" />
        </div>
        <div class="field">
          <div class="muted">최초임용일</div>
          <input id="hireDate" type="date" />
        </div>
        <div class="field">
          <div class="muted">시급(원)</div>
          <div class="row gap">
            <input id="hourlyRate" class="numeric" type="number" step="10" value="11500" />
            <button class="btn-lightgrey" id="preset2025Btn" type="button">2025: 11,200</button>
            <button class="btn-lightgrey" id="preset2026Btn" type="button">2026: 11,500</button>
          </div>
          <div class="hint">시급은 수기 수정 가능</div>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="local-h2">3) 요일별 근무시간대(계약조건)</h2>
      <hr/>

      <div class="card">
        <div class="row between">
          <div class="mini">
            <strong>입력 방법</strong> · 하루에 최대 2개 시간대(출근/퇴근) 입력 → 자동으로 일 근로시간 계산
          </div>
          <label class="mini" style="display:flex; gap:8px; align-items:center;">
            <input id="showManualDailyHours" type="checkbox" />
            날짜별 수동 시간 입력 칸 표시
          </label>
        </div>

        <div class="table-wrap">
          <table class="sheetlike" id="scheduleTable">
            <thead>
              <tr>
                <th style="width: 92px;">요일</th>
                <th>시간대1 (시작)</th>
                <th>시간대1 (종료)</th>
                <th>시간대2 (시작)</th>
                <th>시간대2 (종료)</th>
                <th style="width: 120px;">일 근로시간(시간)</th>
                <th>비고(선택)</th>
              </tr>
            </thead>
            <tbody id="scheduleTbody"></tbody>
          </table>
        </div>

        <div class="row gap">
          <button class="btn ghost" id="loadExampleScheduleBtn" type="button">예시(월~목 3시간 / 금 2시간) 불러오기</button>
          <span class="muted">예시 시간대: 월~목 07:10~08:40, 16:40~18:10 / 금 07:40~08:40, 16:40~17:40</span>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 class="local-h2">4) 출근내역 달력</h2>
      <hr/>

      <div class="row between">
        <div class="mini">
          ·출근(O) 체크 = 해당 요일의 계약시간이 자동 반영됩니다.
          <span class="warn">휴무/결근/변경일은 체크 해제</span>하거나 <span class="warn">수동 시간</span>으로 조정하세요.
        </div>
        <div class="row gap">
          <span class="pill">근무일수: <span class="kpi" id="workDaysText">0</span>일</span>
          <span class="pill">유급 근로시간: <span class="kpi" id="workHoursText">0</span>시간</span>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="calendar" id="calendarTable">
          <thead>
            <tr>
              <th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th>
            </tr>
          </thead>
          <tbody id="calendarTbody"></tbody>
        </table>
      </div>

      <div class="hint">키보드 이동: 체크/입력칸에서 방향키로 셀 이동(엑셀 느낌) · Space: 체크 토글 · Enter: 아래로</div>
    </section>

    <section class="section">
      <h2 class="local-h2">5) 공제(사회보험료 개인부담금 등)</h2>
      <hr/>

      <div class="grid two">
        <div class="card">
          <div class="row between">
            <strong>사회보험료 공제 여부</strong>
            <span class="pill">기본: 미공제</span>
          </div>

          <div class="grid two tight">
            <div class="field">
              <label class="row gap">
                <input id="deductHealthOn" type="checkbox" />
                건강보험(개인) 공제
              </label>
              <div class="row gap">
                <span class="muted">요율(개인)</span>
                <input id="healthRate" class="numeric" type="number" step="0.00001" value="0.03595" />
              </div>
              <div class="row gap">
                <span class="muted">금액(원)</span>
                <input id="healthAmt" class="numeric" type="number" step="10" value="0" />
                <button class="btn-lightgrey" id="healthAutoBtn" type="button">자동</button>
              </div>
            </div>

            <div class="field">
              <label class="row gap">
                <input id="deductLtCareOn" type="checkbox" />
                장기요양(개인) 공제
              </label>
              <div class="row gap">
                <span class="muted">요율(건강보험료×)</span>
                <input id="ltCareRate" class="numeric" type="number" step="0.00001" value="0.1314" />
              </div>
              <div class="row gap">
                <span class="muted">금액(원)</span>
                <input id="ltCareAmt" class="numeric" type="number" step="10" value="0" />
                <button class="btn-lightgrey" id="ltCareAutoBtn" type="button">자동</button>
              </div>
            </div>

            <div class="field">
              <label class="row gap">
                <input id="deductEmpOn" type="checkbox" />
                고용보험(개인) 공제
              </label>
              <div class="row gap">
                <span class="muted">요율(개인)</span>
                <input id="empRate" class="numeric" type="number" step="0.00001" value="0.009" />
              </div>
              <div class="row gap">
                <span class="muted">금액(원)</span>
                <input id="empAmt" class="numeric" type="number" step="10" value="0" />
                <button class="btn-lightgrey" id="empAutoBtn" type="button">자동</button>
              </div>
            </div>

            <div class="field">
              <div class="row gap">
                <label class="row gap">
                  <input id="truncate10won" type="checkbox" checked />
                  10원 단위 절사(자동 산출 시)
                </label>
              </div>
              <div class="hint">보험료는 보통 10원 단위로 처리됩니다. 수기 입력 시엔 그대로 사용됩니다.</div>
            </div>
          </div>
        </div>

        <div class="card">
          <strong>기타 공제(선택)</strong>
          <div class="grid two tight">
            <div class="field">
              <div class="muted">소득세(원)</div>
              <input id="incomeTax" class="numeric" type="number" step="10" value="0" />
            </div>
            <div class="field">
              <div class="muted">주민세(원)</div>
              <input id="localTax" class="numeric" type="number" step="10" value="0" />
            </div>
            <div class="field">
              <div class="muted">국민연금(원)</div>
              <input id="pension" class="numeric" type="number" step="10" value="0" />
            </div>
            <div class="field">
              <div class="muted">기타(원)</div>
              <input id="otherDeduct" class="numeric" type="number" step="10" value="0" />
            </div>
          </div>
        </div>
      </div>

    </section>

    <section class="section">
      <h2 class="local-h2">6) 인건비 산정 결과</h2>
      <hr/>

      <div class="grid three">
        <div class="card">
          <div class="muted">당월 보수 지급액(원)</div>
          <div class="kpi" id="grossPayText">0</div>
          <div class="hint">= 시급 × 유급 근로시간</div>
        </div>
        <div class="card">
          <div class="muted">공제액 계(원)</div>
          <div class="kpi" id="deductTotalText">0</div>
          <div class="hint">보험료+세금+기타 공제</div>
        </div>
        <div class="card">
          <div class="muted">실수령액(원)</div>
          <div class="kpi" id="netPayText">0</div>
          <div class="hint">= 보수 지급액 - 공제액</div>
        </div>
      </div>

      <div class="card">
        <div class="row between">
          <strong>임금명세서 미리보기</strong>
          <span class="pill">엑셀 시트3 / PDF 출력 대상</span>
        </div>

        <div class="preview-box" id="payslipPreview">
          <!-- JS 렌더 -->
        </div>
      </div>
    </section>

    <section class="section no-print">
      <h2 class="local-h2">7) 파일(업로드/저장)</h2>
      <hr/>

      <div class="grid two">
        <div class="card">
          <strong>엑셀 업로드(자동 채우기)</strong>
          <div class="hint">업로드용 서식(.xlsx)을 내려받아 작성 후 업로드하면 자동으로 입력칸이 채워집니다.</div>
          <div class="row gap tight">
            <button class="btn primary" id="downloadTemplateBtn" type="button">업로드용 서식 다운로드</button>
            <input id="uploadXlsx" type="file" accept=".xlsx" />
          </div>
          <div class="hint" id="uploadStatus"></div>
        </div>

        <div class="card">
          <strong>저장</strong>
          <div class="row gap tight">
            <button class="btn primary" id="exportXlsxBtn" type="button">엑셀(.xlsx) 저장(3시트)</button>
            <button class="btn" id="exportPdfBtn" type="button">PDF 저장(임금명세서)</button>
          </div>
          <div class="hint">엑셀: 시트1 출근내역 / 시트2 인건비 산정내역 / 시트3 임금명세서</div>
          <div class="hint warn" id="libWarn"></div>
        </div>
      </div>

    </section>

  </main>

  <script src="./app.js"></script>
</body>
</html>
