<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>복무시간 10진법 환산기기</title>


  <link rel="stylesheet" href="/static/style.css" />

  <style>
    .msg { border:1px solid #e5e5e5; border-radius:12px; padding:10px 12px; background:#fafafa; }
    .msg.ok { border-color:#b7eb8f; background:#f6ffed; }
    .msg.warn { border-color:#ffd666; background:#fffbe6; }
    .msg.err { border-color:#ffccc7; background:#fff2f0; }

    .row { display:flex; align-items:center; }
    .gap { gap:10px; flex-wrap:wrap; }
    .stack { display:flex; flex-direction:column; gap:6px; }
    .mini { font-size:0.92rem; color:#555; }
    .muted { color:#666; }
    .right { text-align:right; }
    .center { text-align:center; }
    .nowrap { white-space:nowrap; }

    .card { border:1px solid #e5e7eb; border-radius:14px; padding:14px 14px; background:#fff; }
    .section { margin: 18px 0; }
    .table-wrap { overflow:auto; border-radius:12px; border:1px solid #e5e7eb; }

    table.sheetlike { width:100%; border-collapse:separate; border-spacing:0; }
    table.sheetlike th, table.sheetlike td { border-bottom:1px solid #e5e7eb; border-right:1px solid #e5e7eb; padding:6px 8px; }
    table.sheetlike th:last-child, table.sheetlike td:last-child { border-right:none; }
    table.sheetlike tr:last-child td { border-bottom:none; }
    table.sheetlike thead th { position: sticky; top: 0; z-index: 3; background: #f8fafc; font-weight:700; }
    table.sheetlike td { background:#fff; }

    input[type="text"], input[type="number"]{
      width:100%;
      min-width: 120px;
      padding:6px 8px;
      border:1px solid #d1d5db;
      border-radius:10px;
      outline: none;
      background:#fff;
    }
    input[readonly]{
      background:#f9fafb;
      cursor: text;
    }
    .w-no { width:72px; min-width:72px; }
    .w-name { width:140px; min-width:140px; }
    .w-time { width:140px; min-width:140px; }
    .w-min { width:140px; min-width:140px; }
    .w-dec { width:160px; min-width:160px; }
    .w-note { width:220px; min-width:220px; }

    .bad input { border-color:#ff4d4f !important; background:#fff2f0; }
    .btn { padding:8px 12px; border-radius:12px; border:1px solid #d1d5db; background:#fff; cursor:pointer; }
    .btn.primary { background:#111; color:#fff; border-color:#111; }
    .btn.light { background:#f3f4f6; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #ddd; background:#fff; font-size:0.9rem; }

    /* sticky 첫 열(연번) & 둘째 열(성명) */
    :root{
      --sticky-col-no: 72px;
      --sticky-col-name: 140px;
    }
    table.sheetlike th:nth-child(1), table.sheetlike td:nth-child(1){
      position: sticky; left: 0; z-index: 2; background:#fff;
      min-width: var(--sticky-col-no);
    }
    table.sheetlike th:nth-child(2), table.sheetlike td:nth-child(2){
      position: sticky; left: var(--sticky-col-no); z-index: 2; background:#fff;
      min-width: var(--sticky-col-name);
      box-shadow: 2px 0 0 #e5e7eb;
    }
    table.sheetlike thead th:nth-child(1), table.sheetlike thead th:nth-child(2){
      z-index: 5; background:#f8fafc;
    }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="shell" style="padding:16px 16px;">
      <h1>복무시간 10진법 환산기</h1>
      <p class="muted"">
        ·일/시간/분단위로 된 복무시간을 10진법 정수(소수점)로 변환해줌
      </p>
    </div>
  </header>

  <main class="container" style="padding: 0 16px 40px;">

    <section class="section">
      <h2 style="margin:0 0 10px;">1) 60진(HH:MM) → 10진(시간)</h2>
      <div class="card">
        <div class="row gap" style="margin-bottom:10px;">
          <button class="btn primary" id="addA">행 추가</button>
          <button class="btn light" id="clearA">초기화</button>
          <span class="pill">붙여넣기: 엑셀 표(TSV) 그대로 OK</span>
          <span class="pill">이동: 방향키 / Enter / Shift+Enter</span>
        </div>

        <div class="row gap" style="margin-bottom:10px;">
          <label class="row gap">
            <span class="mini nowrap">10진 표시 소수점</span>
            <input type="number" id="decPlaces" min="0" max="6" step="1" value="4" style="width:90px; min-width:90px;" />
            <span class="mini nowrap">자리(표시용)</span>
          </label>
          <div class="mini muted">
            ※ 휴가 “일수/시간” 산정은 별도 규칙(소수점 둘째자리 반올림 등)이 있지만, 시간외(가산임금) 계산은 분 단위까지 반영이 원칙입니다.
          </div>
        </div>

        <div class="table-wrap">
          <table class="sheetlike" id="tableA">
            <thead>
              <tr>
                <th class="w-no center nowrap">연번</th>
                <th class="w-name nowrap">성명</th>
                <th class="w-time nowrap">60진 시간 입력</th>
                <th class="w-min right nowrap">총 분(자동)</th>
                <th class="w-dec right nowrap">10진 시간(자동)</th>
                <th class="w-note nowrap">비고</th>
                <th class="center nowrap">행삭제</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="msgA" class="msg" style="margin-top:10px;">
          입력 예시: <span class="kbd">2:20</span>, <span class="kbd">02:20</span>, <span class="kbd">2시간 20분</span>, <span class="kbd">140분</span>, <span class="kbd">1일 2:30</span>
        </div>
      </div>
    </section>

    <section class="section">
      <h2 style="margin:0 0 10px;">2) 10진(시간) → 60진(H:MM)</h2>
      <div class="card">
        <div class="row gap" style="margin-bottom:10px;">
          <button class="btn primary" id="addB">행 추가</button>
          <button class="btn light" id="clearB">초기화</button>

          <label class="row gap">
            <span class="mini nowrap">10진→분 변환</span>
            <select id="roundMode" style="padding:7px 10px;border:1px solid #d1d5db;border-radius:10px;">
              <option value="round" selected>반올림(기본)</option>
              <option value="floor">절사(내림)</option>
              <option value="ceil">올림</option>
            </select>
          </label>

          <span class="pill">기본은 “분 단위 복원”을 목표로 반올림</span>
        </div>

        <div class="table-wrap">
          <table class="sheetlike" id="tableB">
            <thead>
              <tr>
                <th class="w-no center nowrap">연번</th>
                <th class="w-name nowrap">성명</th>
                <th class="w-dec right nowrap">10진 시간 입력</th>
                <th class="w-min right nowrap">총 분(자동)</th>
                <th class="w-time nowrap">60진(H:MM)(자동)</th>
                <th class="w-note nowrap">비고</th>
                <th class="center nowrap">행삭제</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div id="msgB" class="msg" style="margin-top:10px;">
          팁: 위 표에서 만들어진 10진수를 그대로 아래에 붙여넣으면, 원래 분 단위가 거의 그대로 복원됩니다(표시 소수점 자리수에 따라 약간 달라질 수 있음).
        </div>
      </div>
    </section>

    <div class="msg ok">
      <div><b>정책/근거 메모(핵심)</b></div>
      <ul style="margin:8px 0 0;">
        <li>시간외(연장·야간·휴일) 가산임금 계산 단위: 발생한 시간외근로의 <b>‘분’ 단위까지 모두 반영</b></li>
        <li>연차/휴가 “일수” 부여·정산은 소수점 처리 규칙이 별도로 존재(일수 소수점 반올림, 분 단위 부여 안 함 등)</li>
      </ul>
    </div>

  </main>

<script>
(() => {
  "use strict";

  const cfg = {
    decPlaces: 4,     // 10진 표시 소수점 자리(표시용)
    roundMode: "round"// 10진->분 변환 방식
  };

  const $ = (sel) => document.querySelector(sel);

  // ---------- 유틸 ----------
  function escapeHtml(s) {
    return String(s ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function clampInt(n, min, max) {
    n = Math.trunc(n);
    return Math.max(min, Math.min(max, n));
  }

  function pow10(n) {
    return Math.pow(10, n);
  }

  function roundTo(x, dp) {
    if (!Number.isFinite(x)) return NaN;
    const p = pow10(dp);
    return Math.round((x + Number.EPSILON) * p) / p;
  }

  function fmtFixed(x, dp) {
    if (!Number.isFinite(x)) return "";
    return roundTo(x, dp).toFixed(dp);
  }

  function normalizeNumberLike(s) {
    return String(s ?? "").trim().replaceAll(",", ""); // 1,234.5 허용
  }

  // ---------- 파싱: 60진 시간 입력(기간/누적시간) ----------
  // 허용 예시: "2:20", "02:20", "2시간 20분", "140분", "1일 2:30", "1일 2시간 30분"
  function parseDurationToMinutes(raw) {
    const s0 = String(raw ?? "").trim();
    if (!s0) return null;

    let s = s0.replace(/\s+/g, " ").trim();

    // 1) 일(day) 먼저 처리
    let days = 0;
    const md = s.match(/(\d+)\s*일/);
    if (md) {
      days = Number(md[1]);
      s = s.replace(md[0], "").trim();
    }

    // 2) H:MM
    const mt = s.match(/^(\d+)\s*:\s*([0-5]?\d)$/);
    if (mt) {
      const h = Number(mt[1]);
      const m = Number(mt[2]);
      return (days * 24 * 60) + (h * 60) + m;
    }

    // 3) "n시간 n분" / "n시간" / "n분"
    const mhm = s.match(/(?:(\d+)\s*시간)?\s*(?:(\d+)\s*분)?$/);
    if (mhm && (mhm[1] || mhm[2])) {
      const h = mhm[1] ? Number(mhm[1]) : 0;
      const m = mhm[2] ? Number(mhm[2]) : 0;
      if (m >= 60) return null; // "2시간 75분"은 에러로 처리
      return (days * 24 * 60) + (h * 60) + m;
    }

    // 4) "140분" 같은 케이스(명시 분)
    const mOnly = s.match(/^(\d+)\s*분$/);
    if (mOnly) {
      return (days * 24 * 60) + Number(mOnly[1]);
    }

    // 5) 숫자만 있으면 "분"으로 간주(너무 파워풀하면 오히려 사고나서…)
    if (/^\d+$/.test(s)) {
      return (days * 24 * 60) + Number(s);
    }

    return null;
  }

  function minutesToHhMm(mins) {
    const m = Math.max(0, Math.round(Number(mins || 0)));
    const h = Math.floor(m / 60);
    const mm = m - h * 60;
    return `${h}:${String(mm).padStart(2, "0")}`;
  }

  // ---------- 엑셀형 이동/붙여넣기 ----------
  function setGridMeta(tableEl) {
    const tbody = tableEl.tBodies[0];
    const rows = Array.from(tbody.rows);
    rows.forEach((tr, rIdx) => {
      tr.querySelectorAll("input[data-grid='1']").forEach(inp => {
        inp.dataset.r = String(rIdx);
      });
      const no = tr.querySelector("[data-rowno]");
      if (no) no.textContent = String(rIdx + 1);
    });
  }

  function getCellInput(tableEl, r, c) {
    return tableEl.querySelector(`tbody input[data-grid='1'][data-r='${r}'][data-c='${c}']`) || null;
  }

  function focusCell(tableEl, r, c) {
    const tgt = getCellInput(tableEl, r, c);
    if (tgt) {
      tgt.focus();
      tgt.select?.();
      return true;
    }
    return false;
  }

  function gridKeydownHandler(e) {
    const inp = e.target;
    if (!(inp instanceof HTMLInputElement)) return;
    if (inp.dataset.grid !== "1") return;

    const tableEl = inp.closest("table");
    if (!tableEl) return;

    const r = Number(inp.dataset.r);
    const c = Number(inp.dataset.c);

    // Enter: 아래로(Shift+Enter: 위로)
    if (e.key === "Enter") {
      e.preventDefault();
      const dr = e.shiftKey ? -1 : 1;
      focusCell(tableEl, r + dr, c);
      return;
    }

    // Arrow: 엑셀 느낌(좌/우는 커서가 끝/처음일 때만 셀 이동)
    if (e.key === "ArrowUp") {
      e.preventDefault();
      focusCell(tableEl, r - 1, c);
      return;
    }
    if (e.key === "ArrowDown") {
      e.preventDefault();
      focusCell(tableEl, r + 1, c);
      return;
    }

    if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
      let start = 0, end = 0;
      try {
        start = inp.selectionStart ?? 0;
        end = inp.selectionEnd ?? 0;
      } catch { /* ignore */ }

      const valLen = (inp.value ?? "").length;
      const atLeftEdge = (start === 0 && end === 0);
      const atRightEdge = (start === valLen && end === valLen);

      if (e.key === "ArrowLeft" && atLeftEdge) {
        e.preventDefault();
        focusCell(tableEl, r, c - 1);
        return;
      }
      if (e.key === "ArrowRight" && atRightEdge) {
        e.preventDefault();
        focusCell(tableEl, r, c + 1);
        return;
      }
      // 그 외는 기본(커서 이동) 허용
    }
  }

  function gridPasteHandler(e) {
    const inp = e.target;
    if (!(inp instanceof HTMLInputElement)) return;
    if (inp.dataset.grid !== "1") return;

    const text = e.clipboardData?.getData("text") ?? "";
    if (!text.includes("\t") && !text.includes("\n")) return; // 일반 paste는 브라우저에 맡김

    const tableEl = inp.closest("table");
    if (!tableEl) return;

    e.preventDefault();

    const startR = Number(inp.dataset.r);
    const startC = Number(inp.dataset.c);

    const rows = text
      .replace(/\r\n/g, "\n")
      .replace(/\r/g, "\n")
      .split("\n")
      .map(line => line.split("\t"));

    for (let rr = 0; rr < rows.length; rr++) {
      for (let cc = 0; cc < rows[rr].length; cc++) {
        const v = rows[rr][cc];
        const cell = getCellInput(tableEl, startR + rr, startC + cc);
        if (!cell) continue;
        cell.value = v;
        cell.dispatchEvent(new Event("input", { bubbles: true }));
        cell.dispatchEvent(new Event("change", { bubbles: true }));
      }
    }

    // 마지막 셀로 포커스 이동
    focusCell(tableEl, startR + rows.length - 1, startC + rows[rows.length - 1].length - 1);
  }

  function bindGrid(tableEl) {
    tableEl.addEventListener("keydown", gridKeydownHandler);
    tableEl.addEventListener("paste", gridPasteHandler);
  }

  // ---------- 표 A: 60 -> 10 ----------
  function computeRowA(tr) {
    const timeInp = tr.querySelector("input[data-a='time']");
    const minsOut = tr.querySelector("input[data-a='mins']");
    const decOut  = tr.querySelector("input[data-a='dec']");
    const rowOk = tr;

    const raw = timeInp.value;
    const mins = parseDurationToMinutes(raw);

    rowOk.classList.remove("bad");
    minsOut.value = "";
    decOut.value = "";

    if (raw.trim() === "") return;

    if (mins == null || !Number.isFinite(mins) || mins < 0) {
      rowOk.classList.add("bad");
      return;
    }

    minsOut.value = String(Math.round(mins));
    const dec = mins / 60;
    decOut.value = fmtFixed(dec, cfg.decPlaces);
  }

  function makeRowA() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="w-no center nowrap" data-rowno></td>
      <td class="w-name">
        <input type="text" data-grid="1" data-c="0" data-a="name" placeholder="성명" />
      </td>
      <td class="w-time">
        <input type="text" data-grid="1" data-c="1" data-a="time" placeholder="예: 2:20" />
      </td>
      <td class="w-min right">
        <input type="text" data-grid="1" data-c="2" data-a="mins" readonly />
      </td>
      <td class="w-dec right">
        <input type="text" data-grid="1" data-c="3" data-a="dec" readonly />
      </td>
      <td class="w-note">
        <input type="text" data-grid="1" data-c="4" data-a="note" placeholder="비고" />
      </td>
      <td class="center nowrap">
        <button class="btn light" data-del="A">삭제</button>
      </td>
    `;

    const timeInp = tr.querySelector("input[data-a='time']");
    timeInp.addEventListener("input", () => computeRowA(tr));

    // name/note는 계산 없음
    return tr;
  }

  function refreshA() {
    const table = $("#tableA");
    setGridMeta(table);
    Array.from(table.tBodies[0].rows).forEach(tr => computeRowA(tr));
  }

  // ---------- 표 B: 10 -> 60 ----------
  function computeRowB(tr) {
    const decInp  = tr.querySelector("input[data-b='decIn']");
    const minsOut = tr.querySelector("input[data-b='mins']");
    const timeOut = tr.querySelector("input[data-b='time']");
    tr.classList.remove("bad");
    minsOut.value = "";
    timeOut.value = "";

    const raw = normalizeNumberLike(decInp.value);
    if (raw.trim() === "") return;

    const h = Number(raw);
    if (!Number.isFinite(h) || h < 0) {
      tr.classList.add("bad");
      return;
    }

    const rawMinutes = h * 60;
    let mins;
    if (cfg.roundMode === "floor") mins = Math.floor(rawMinutes + 1e-9);
    else if (cfg.roundMode === "ceil") mins = Math.ceil(rawMinutes - 1e-9);
    else mins = Math.round(rawMinutes);

    minsOut.value = String(mins);
    timeOut.value = minutesToHhMm(mins);
  }

  function makeRowB() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="w-no center nowrap" data-rowno></td>
      <td class="w-name">
        <input type="text" data-grid="1" data-c="0" data-b="name" placeholder="성명" />
      </td>
      <td class="w-dec right">
        <input type="text" data-grid="1" data-c="1" data-b="decIn" placeholder="예: 3.3333" />
      </td>
      <td class="w-min right">
        <input type="text" data-grid="1" data-c="2" data-b="mins" readonly />
      </td>
      <td class="w-time">
        <input type="text" data-grid="1" data-c="3" data-b="time" readonly />
      </td>
      <td class="w-note">
        <input type="text" data-grid="1" data-c="4" data-b="note" placeholder="비고" />
      </td>
      <td class="center nowrap">
        <button class="btn light" data-del="B">삭제</button>
      </td>
    `;

    const decInp = tr.querySelector("input[data-b='decIn']");
    decInp.addEventListener("input", () => computeRowB(tr));
    return tr;
  }

  function refreshB() {
    const table = $("#tableB");
    setGridMeta(table);
    Array.from(table.tBodies[0].rows).forEach(tr => computeRowB(tr));
  }

  // ---------- 공통: 행 추가/삭제 ----------
  function addRows(tableId, n) {
    const table = $(tableId);
    const tbody = table.tBodies[0];
    for (let i = 0; i < n; i++) {
      tbody.appendChild(tableId === "#tableA" ? makeRowA() : makeRowB());
    }
    if (tableId === "#tableA") refreshA();
    else refreshB();
  }

  function clearTable(tableId) {
    const table = $(tableId);
    table.tBodies[0].innerHTML = "";
    addRows(tableId, 15);
  }

  function bindDelete(tableId) {
    const table = $(tableId);
    table.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-del]");
      if (!btn) return;
      const tr = btn.closest("tr");
      tr?.remove();
      if (tableId === "#tableA") refreshA();
      else refreshB();
    });
  }

  // ---------- 설정 바인딩 ----------
  function bindConfig() {
    $("#decPlaces").addEventListener("change", () => {
      const v = clampInt(Number($("#decPlaces").value), 0, 6);
      cfg.decPlaces = v;
      $("#decPlaces").value = String(v);
      refreshA();
    });

    $("#roundMode").addEventListener("change", () => {
      cfg.roundMode = String($("#roundMode").value || "round");
      refreshB();
    });
  }

  // ---------- init ----------
  function init() {
    // grid 바인딩
    bindGrid($("#tableA"));
    bindGrid($("#tableB"));

    // 삭제 바인딩
    bindDelete("#tableA");
    bindDelete("#tableB");

    // 버튼
    $("#addA").addEventListener("click", () => addRows("#tableA", 1));
    $("#addB").addEventListener("click", () => addRows("#tableB", 1));
    $("#clearA").addEventListener("click", () => clearTable("#tableA"));
    $("#clearB").addEventListener("click", () => clearTable("#tableB"));

    bindConfig();

    // 기본 15행
    addRows("#tableA", 15);
    addRows("#tableB", 15);
  }

  init();
})();
</script>

<script src="/static/disable-copy.js"></script>
<script src="/static/footer.js"></script>
<script src="/static/global-loader.js?v=1"></script>


  
</body>
</html>
